<!DOCTYPE html>
<html lang="en">
<head>
<title>Coverage</title>
<meta charset="utf-8"/>
<style>
@media screen{
    html {background-color: #FFFFF0;}
body {
    font-size: 16px;
    font-family : Verdana, "Bitstream Vera Sans", "DejaVu Sans", Tahoma, Geneva, Arial, Sans-serif;
    margin: 1em;
}
th, td {padding: 5px 10px;}
th {text-align: left;}
h1, h2, h3, h4, h5, h6 {color: #424242;}
h1 {font-size: 22px;}
h2 {font-size: 18px; margin-top: 2em; margin-bottom:0.3em;}
tbody tr:nth-child(even) {background-color: #F0F0F0;}
tbody tr:nth-child(odd) {background-color: #FAFAFA;}
th {background-color: #E6E6E6;color: #424242;}
table {border: silver 1px solid; font-size: 14px;font-family: APLFont, monospace;}
code , code a {font-size: 14px; font-family: APLFont, monospace;}
code.header {
    font-size: 16px; 
    font-family: APLFont, monospace; 
    margin: 1.5em 0.5em 0 0.5em; 
    padding:0;
    display: block;
}
div.code-block {
    border: 1px silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 0.5em 0.5em 0.5em 0.5em;
    padding: 0.5em;
}
div.code-block.missing {
    background-color: #fa605254;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
ul li, ol li {margin: 0.7em 0.2em;}
.float-right {float:right;}
.no-underline {    text-decoration :none;}
.top-links {font-size:20px; padding-left: 0.6em;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5px; padding-top:0; font-size: 9px;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 0.5em; padding: 0.5em;}
}
@media print{@page {size: portrait}
@page {
    margin: 1cm 1cm 1cm 1.75cm;
    @bottom-right {
        content: counter(page) " / " counter(pages);
  }
}
body {
    font: 12pt "Times New Roman", Times, serif;
    line-height: 1.2;
     /* CSS3 filter, at the moment Webkit only. Prefix it for future implementations */
    -webkit-filter: grayscale(100%);
    filter: grayscale(100%); /* future-proof */
}
h1 {font-size: 18pt;}
h2 {font-size: 16pt; margin-top: 10pt; margin-bottom: 3pt;}
th, td {padding: 2pt 3pt;}
th {text-align: left;background-color: #DBDBDB;}
tbody tr:nth-child(odd) {background-color: #EDEDED;}
table {
    color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    font-size: 8pt;
    font-family: APLFont, monospace;
}
div.keep-together {break-inside: avoid; break-before:auto;}
table {border: silver 1pt solid;}
code , code a {font-size: 8pt; font-family: APLFont, monospace;}
code.header {
    font-size: 8pt;
    font-family: APLFont, monospace;
    margin: 7pt 3pt 0 10pt;
    padding:0;
    display: block;
}
div.code-block {
    border: 1pt silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 4pt 4pt 4pt 4pt;
    padding: 4pt;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
a {text-decoration: none;color: black;}
ul li, ol li {margin: 8pt 3pt;}
.no-print {display:none;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5pt; padding-top:0; font-size: 6pt;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 8px; padding: 8px;}
}
</style>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.js"></script>
</head>
<body>
<h1 id="top">Coverage Report</h1>
<p>Watched: 17 fns/opr within <code>#.Execute.Execute</code></p>
<p>The test suite was executed once:</p>
<table>
<thead>
<tr><th>Executed at</th><th>APLVersion</th><th>Memory (MB)</th></tr>
</thead>
<tbody>
<tr><td>2025-04-05 13:22:24</td><td>Windows-64 ⋄ 19.0.50771.0 ⋄ W ⋄ Development ⋄ Unicode</td><td>114</td></tr>
</tbody>
</table>
<p>Overall 80% of the testable code is covered.</p>
<p>(Comment lines, empty lines, all <code>:End</code>* lines etc. are ignored)</p>
<p>6 of the fns/opr are 100% covered.</p>
<div id="partly-covered" class="keep-together">
<table id="percent">
<thead>
<tr><th style="text-align:left;">Function/Operator</th><th style="text-align:left;">Lines not executed</th><th style="text-align:left;">Coverage</th><th style="text-align:right;">≢</th></tr>
</thead>
<tbody>
<tr class="uncovered"><td><a href="#listing_1" title="Link to listing">#.Execute.Execute.Version</a></td><td>4, 5, 9</td><td>0</td><td>3</td></tr>
<tr><td><a href="#listing_2" title="Link to listing">#.Execute.Execute.GetExitCodeThread</a></td><td>4, 5</td><td>60</td><td>5</td></tr>
<tr><td><a href="#listing_3" title="Link to listing">#.Execute.Execute.TerminateProcess</a></td><td>4, 5</td><td>60</td><td>5</td></tr>
<tr><td><a href="#listing_4" title="Link to listing">#.Execute.Execute.GetExitCodeProcess</a></td><td>4, 5</td><td>67</td><td>6</td></tr>
<tr><td><a href="#listing_5" title="Link to listing">#.Execute.Execute.CR</a></td><td>2</td><td>67</td><td>3</td></tr>
<tr><td><a href="#listing_6" title="Link to listing">#.Execute.Execute.LF</a></td><td>2</td><td>67</td><td>3</td></tr>
<tr><td><a href="#listing_7" title="Link to listing">#.Execute.Execute.CreateStartupInfo</a></td><td>5</td><td>75</td><td>4</td></tr>
<tr><td><a href="#listing_8" title="Link to listing">#.Execute.Execute.EnforceBackslash</a></td><td>3, 4</td><td>75</td><td>8</td></tr>
<tr><td><a href="#listing_9" title="Link to listing">#.Execute.Execute.Process</a></td><td>19←≢35,42,87-90,112-113,118-119,128,133-135,144-146,149-150</td><td>81</td><td>102</td></tr>
<tr><td><a href="#listing_10" title="Link to listing">#.Execute.Execute.Application</a></td><td>9←≢27,33,41-43,79-81,84</td><td>84</td><td>58</td></tr>
<tr><td><a href="#listing_11" title="Link to listing">#.Execute.Execute.WaitForSingleObject</a></td><td>15, 17</td><td>86</td><td>14</td></tr>
<tr class="fullyCovered"><td><a href="#listing_12" title="Link to listing">#.Execute.Execute.History</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_13" title="Link to listing">#.Execute.Execute.DefaultParms</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_14" title="Link to listing">#.Execute.Execute.ExpandEnv</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_15" title="Link to listing">#.Execute.Execute.QnaType</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_16" title="Link to listing">#.Execute.Execute.Is64Bit</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_17" title="Link to listing">#.Execute.Execute.cs</a></td><td></td><td>100</td><td>0</td></tr>
</tbody>
</table>
</div>
<script>
$(document).ready(function() {
    var oTable;
    oTable = $("#percent").DataTable( {
        paging:   false,
        ordering: true,
        info:     true,
        fixedHeader: true,
        order: [2,"asc"],
        dom: "Bft",
        drawCallback: function( settings ) {
             var api = this.api();
             $('.header[id^="listing_"]').next().addBack().css("display","none");
             api.rows( {page:"current"} ).data().each(function(data){
              id = data[0];
              id = id.match(/"(\#.*?)"/);
              if (id){$(id[1]).next().addBack().css("display","block");}
             })
        },      
        buttons: [
        {
            text: "Partly covered (10)",
            titleAttr: "50%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^(?!(0%|100%)).*";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Uncovered (1)",
            titleAttr: "0%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^0%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Fully covered (6)",
            titleAttr: "100%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "100%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "All (17)",
            titleAttr: "all",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = ".";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
    ],
 
        columnDefs: [
            {className: "align-right", targets: [2,3]
            },
            {
                render: function ( data, type, row, meta ) {
                            return data+"%" ;        
                        },
                targets: 2
            }
        ]             
    } );
    oTable.button(0).trigger();

} );    
</script>
<h2>Listings</h2>
<code class="header" id="listing_1">#.Execute.Execute.Version &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←Version</code>
<code> [1]      ⍝ Returns the version number from `TatinVars` if possible.</code>
<code> [2]      ⍝ See also `History`</code>
<code> [3]   :Access Public Shared</code>
<code class="emphasize">→[4]   :If 0&lt;##.⎕NC'TatinVars.CONFIG'</code>
<code class="emphasize">→[5]       r←(⎕JSON⍠('Dialect' 'JSON5')⊢##.TatinVars.CONFIG).version</code>
<code> [6]   :Else</code>
<code> [7]      ⍝ When a script was not loaded with Tatin, there will be no namespace `TatinVars`.</code>
<code> [8]      ⍝ In such cases we cannot provide a version number, so we return just ''.</code>
<code class="emphasize">→[9]       r←''</code>
<code> [10]  :EndIf</code>
</div>
<code class="header" id="listing_2">#.Execute.Execute.GetExitCodeThread &mdash; 60%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {(rc more)}←(ExFns GetExitCodeThread)threadHandle</code>
<code> [1]  (rc more)←0 ''</code>
<code> [2]  (rc_ exitCode)←ExFns(threadHandle 1)</code>
<code> [3]  :If 0=rc_</code>
<code class="emphasize">→[4]      rc←GetLastError</code>
<code class="emphasize">→[5]      more←'Error in "GetExitCodeThread"'</code>
<code> [6]  :EndIf</code>
</div>
<code class="header" id="listing_3">#.Execute.Execute.TerminateProcess &mdash; 60%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {(rc more)}←(ExFns TerminateProcess)Parms</code>
<code> [1]  (rc more)←0 ''</code>
<code> [2]  (processHandle exitCode)←2↑Parms</code>
<code> [3]  :If 0=ExFns(processHandle exitCode)</code>
<code class="emphasize">→[4]      rc←GetLastError</code>
<code class="emphasize">→[5]      more←'Error in "TerminateProcess"'</code>
<code> [6]  :EndIf</code>
</div>
<code class="header" id="listing_4">#.Execute.Execute.GetExitCodeProcess &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> (rc result more)←(ExFns GetExitCodeProcess)processHandle</code>
<code> [1]  (rc result more)←0 0 ''</code>
<code> [2]  result←ExFns processHandle 1</code>
<code> [3]  :If 0=↑result</code>
<code class="emphasize">→[4]      rc←GetLastError</code>
<code class="emphasize">→[5]      more←'Error in GetExitCodeProcess'</code>
<code> [6]  :Else</code>
<code> [7]      result←1⊃result</code>
<code> [8]  :EndIf</code>
</div>
<code class="header" id="listing_5">#.Execute.Execute.CR &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←CR</code>
<code> [1]  :If 82=⎕DR' ' ⍝ Classic version?</code>
<code class="emphasize">→[2]      r←⎕UCS 13</code>
<code> [3]  :Else</code>
<code> [4]      r←⎕UCS 9834</code>
<code> [5]  :EndIf</code>
</div>
<code class="header" id="listing_6">#.Execute.Execute.LF &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←LF</code>
<code> [1]  :If 82=⎕DR' ' ⍝ Classic version?</code>
<code class="emphasize">→[2]      r←⎕UCS 10</code>
<code> [3]  :Else</code>
<code> [4]      r←⎕UCS 9689</code>
<code> [5]  :EndIf</code>
</div>
<code class="header" id="listing_7">#.Execute.Execute.CreateStartupInfo &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←CreateStartupInfo hiddenFlag</code>
<code> [1]  :If Is64Bit</code>
<code> [2]      pad←0              ⍝ for Dyalog 64-bit</code>
<code> [3]      r←104 pad 0 0 0 0 0 640 480 80 25 30,hiddenFlag,0 0 pad 0 0 0 0</code>
<code> [4]  :Else</code>
<code class="emphasize">→[5]      r←68 0 0 0 0 0 640 480 80 25 30,hiddenFlag,0 0 0 0 0 0</code>
<code> [6]  :EndIf</code>
</div>
<code class="header" id="listing_8">#.Execute.Execute.EnforceBackslash &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  cmd←EnforceBackslash cmd</code>
<code> [1]   cmd←##.APLTreeUtils2.DLB ##.APLTreeUtils2.DTB cmd</code>
<code> [2]   :If '"'=1⍴cmd</code>
<code class="emphasize">→[3]       ind←+/∧\2&gt;+\'"'=cmd</code>
<code class="emphasize">→[4]       path←ind↑cmd</code>
<code> [5]   :Else</code>
<code> [6]       ind←cmd⍳' '</code>
<code> [7]       path←ind↑cmd</code>
<code> [8]   :EndIf</code>
<code> [9]   ((path='/')/path)←'\'</code>
<code> [10]  cmd←path,ind↓cmd</code>
</div>
<code class="header" id="listing_9">#.Execute.Execute.Process &mdash; 81%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>   (rc stdOutput exitCode)←{directory}Process commandLine</code>
<code> [1]    :Access Public Shared</code>
<code> [2]       ⍝ # Overview</code>
<code> [3]       ⍝ Run "program" in the same environment as the calling process.</code>
<code> [4]       ⍝</code>
<code> [5]       ⍝ Executes a new task in a hidden window and returns stdout.</code>
<code> [6]       ⍝</code>
<code> [7]       ⍝ ## The right argument</code>
<code> [8]       ⍝ `commandLine` can be one of:</code>
<code> [9]       ⍝ * Simple char vector naming the task and blank separated command line arguments.</code>
<code> [10]      ⍝ * Vector of char vectors. All items but the first are taken as input then.</code>
<code> [11]      ⍝</code>
<code> [12]      ⍝ An example for the latter case would be:  `'cmd' 'dir' 'exit 129'`</code>
<code> [13]      ⍝</code>
<code> [14]      ⍝ This starts a console, runs the "DIR" command and then exits with code 129.</code>
<code> [15]      ⍝</code>
<code> [16]      ⍝ ## The optional left argument</code>
<code> [17]      ⍝ The task is executed in "directory" if given or in the current directory if not.</code>
<code> [18]      ⍝</code>
<code> [19]      ⍝ ## The explicit result</code>
<code> [20]      ⍝ The result of the function is:</code>
<code> [21]      ⍝ 1) the return code, 0 is okay. Note that is is **not** the exit code of the application!</code>
<code> [22]      ⍝ 2) the task's result, converted to a vector of vectors.</code>
<code> [23]      ⍝</code>
<code> [24]      ⍝ If the function hangs it may be interrupted by Ctrl-Break.</code>
<code> [25]      ⍝</code>
<code> [26]      ⍝ The accumulated result is always returned.</code>
<code> [27]   ⎕IO←0 ⋄ ⎕ML←3</code>
<code> [28]   rc←0 ⋄ exitCode←¯1</code>
<code> [29]   '∆GetCurrentDirectory'⎕NA'I4 KERNEL32.C32|GetCurrentDirectory',QnaType,' I4 &gt;T[]'</code>
<code> [30]   ⎕NA'I KERNEL32|GetEnvironmentStrings'</code>
<code> [31]   'ExpandEnvironmentStrings'⎕NA'I KERNEL32|ExpandEnvironmentStrings',QnaType,' &lt;0T &gt;0T I'</code>
<code> [32]   :If Is64Bit</code>
<code> [33]       ⎕NA'I4 KERNEL32|CreatePipe &gt;P  &gt;P &lt;{I4 I4 P I4} I4'</code>
<code> [34]   :Else</code>
<code class="emphasize">→[35]       ⎕NA'I4 KERNEL32|CreatePipe &gt;P &gt;P &lt;{I4 P I4} I4'</code>
<code> [36]   :EndIf</code>
<code> [37]   ⎕NA'I KERNEL32|GetEnvironmentStrings'</code>
<code> [38]   ⎕NA'I KERNEL32|CloseHandle I'</code>
<code> [39]   :If Is64Bit</code>
<code> [40]       strstartupinfo←' &lt;{I4 U4 P P P I4 I4 I4 I4 I4 I4 I4 I4   I2 I2 U4 P P P P} '</code>
<code> [41]   :Else</code>
<code class="emphasize">→[42]       strstartupinfo←' &lt;{I4    P P P I4 I4 I4 I4 I4 I4 I4 I4   I2 I2    P P P P} '</code>
<code> [43]   :EndIf</code>
<code> [44]   'CreateProcess'⎕NA'I4 kernel32.dll|CreateProcess* I4 &lt;0T P P I4 I4 P &lt;0T ',strstartupinfo,'&gt;{P P I4 I4}'</code>
<code> [45]   'FreeEnvironmentStrings'⎕NA'I KERNEL32|FreeEnvironmentStrings',QnaType,' I'</code>
<code> [46]   'CharToOemCBuff'⎕NA'I USER32|CharToOemBuff',QnaType,' &lt;T[] &gt;C[] I'</code>
<code> [47]   'OemCToCharBuff'⎕NA'I USER32|OemToCharBuff',QnaType,' &lt;C[] &gt;T[] I'</code>
<code> [48]   'WriteFileC'⎕NA'I KERNEL32|WriteFile I &lt;C[] I &gt;I I'</code>
<code> [49]   '∆GetExitCodeProcess'⎕NA'I4 KERNEL32.C32|GetExitCodeProcess I4 &gt;I4'</code>
<code> [50]   '∆GetExitCodeThread'⎕NA'I4 KERNEL32.C32|GetExitCodeThread I4 &gt;I4'</code>
<code> [51]   '∆TerminateProcess'⎕NA'I4 KERNEL32.C32|TerminateProcess I4 I4'</code>
<code> [52]   '∆TerminateThread'⎕NA'I4 KERNEL32.C32|TerminateThread I4 I4'</code>
<code> [53]   'PeekNamedPipeAvail'⎕NA'I KERNEL32|PeekNamedPipe I I I I &gt;I I'</code>
<code> [54]   'GetLastError'⎕NA'I4 KERNEL32.C32|GetLastError'</code>
<code> [55]   '∆WaitForSingleObject'⎕NA'I KERNEL32|WaitForSingleObject&amp; I I'</code>
<code> [56]   'ReadFileC'⎕NA'I KERNEL32|ReadFile I &gt;C[] I &gt;I I'</code>
<code> [57]   NORMAL_PRIORITY_CLASS←32</code>
<code> [58]   CREATE_SEPARATE_WOW_VDM←2048</code>
<code> [59]   STILL_ACTIVE←259</code>
<code> [60]   CONTROL_C_EXIT←¯1073741510</code>
<code> [61]   ERROR_PROCESS_ABORTED←1067</code>
<code> [62]   WAIT_OBJECT_0←0</code>
<code> [63]   STATUS_WAIT_0←0</code>
<code> [64]   MAX_PATH←520</code>
<code> [65]   STARTF_USESHOWWINDOW←1</code>
<code> [66]   STARTF_USESTDHANDLES←256</code>
<code> [67]   :If 0=⎕NC'directory'</code>
<code> [68]       directory←⊃↑/∆GetCurrentDirectory MAX_PATH MAX_PATH</code>
<code> [69]   :Else</code>
<code> [70]       directory←1⊃ExpandEnvironmentStrings directory MAX_PATH MAX_PATH</code>
<code> [71]   :EndIf</code>
<code> [72]   :If 1&lt;≡commandLine</code>
<code> [73]       stdInput←∊(1↓commandLine),¨⊂⎕UCS 13 10</code>
<code> [74]       commandLine←↑commandLine</code>
<code> [75]   :Else</code>
<code> [76]       stdInput←''</code>
<code> [77]       commandLine←,commandLine</code>
<code> [78]   :EndIf</code>
<code> [79]   commandLine←1⊃ExpandEnvironmentStrings commandLine 2048 2048</code>
<code> [80]   :If Is64Bit</code>
<code> [81]       pad←0</code>
<code> [82]       SECURITY_ATTRIBUTES←20 pad 0 0</code>
<code> [83]       securityAttributes←SECURITY_ATTRIBUTES</code>
<code> [84]       securityAttributes[3]←true</code>
<code> [85]       (validFlag hStdInputRead hStdInputWrite)←CreatePipe 0 0 securityAttributes(0×↑⍴stdInput)</code>
<code> [86]   :Else</code>
<code class="emphasize">→[87]       SECURITY_ATTRIBUTES←12 0 0</code>
<code class="emphasize">→[88]       securityAttributes←SECURITY_ATTRIBUTES</code>
<code class="emphasize">→[89]       securityAttributes[2]←true</code>
<code class="emphasize">→[90]       (validFlag hStdInputRead hStdInputWrite)←CreatePipe 0 0 securityAttributes(0×↑⍴stdInput)</code>
<code> [91]   :EndIf</code>
<code> [92]   :If validFlag</code>
<code> [93]       securityAttributes←SECURITY_ATTRIBUTES</code>
<code> [94]       securityAttributes[2+Is64Bit]←true</code>
<code> [95]       (validFlag hStdOutputRead hStdOutputWrite)←CreatePipe 0 0 securityAttributes 0</code>
<code> [96]       :If validFlag</code>
<code> [97]           pEnvironment←GetEnvironmentStrings</code>
<code> [98]           startupInfo←(¯3↓CreateStartupInfo(1+STARTF_USESTDHANDLES)),hStdInputRead,hStdOutputWrite,hStdOutputWrite</code>
<code> [99]           (validFlag processInformation)←CreateProcess null commandLine null null true(NORMAL_PRIORITY_CLASS+CREATE_SEPARATE_WOW_VDM)pEnvironment directory startupInfo 0</code>
<code> [100]          :If validFlag</code>
<code> [101]              (hProcess hThread processId threadId)←processInformation</code>
<code> [102]              validFlag←CloseHandle¨hStdInputRead hStdOutputWrite</code>
<code> [103]              validFlag←FreeEnvironmentStrings pEnvironment</code>
<code> [104]              :If 0=↑⍴stdInput</code>
<code> [105]              :OrIf ↑validFlag numberOfBytesWritten←WriteFileC hStdInputWrite(1⊃CharToOemCBuff(⊂stdInput),2⍴↑⍴stdInput)(↑⍴stdInput)0 0</code>
<code> [106]                  validFlag←CloseHandle hStdInputWrite</code>
<code> [107]                  stdOutput←''</code>
<code> [108]                  :Trap 1000</code>
<code> [109]                      :While true STILL_ACTIVE≡2↑∆GetExitCodeProcess hProcess 1</code>
<code> [110]                          :If ↑validFlag cbAvail←PeekNamedPipeAvail hStdOutputRead 0 0 0 0 0</code>
<code> [111]                          :AndIf 0≠cbAvail</code>
<code class="emphasize">→[112]                              validFlag Buffer numberOfBytesRead←ReadFileC hStdOutputRead cbAvail cbAvail 0 0</code>
<code class="emphasize">→[113]                              stdOutput,←1⊃OemCToCharBuff Buffer numberOfBytesRead numberOfBytesRead</code>
<code> [114]                          :EndIf</code>
<code> [115]                      :Until WAIT_OBJECT_0=∆WaitForSingleObject hProcess 10</code>
<code> [116]                      exitCode←1⊃(∆GetExitCodeProcess GetExitCodeProcess)hProcess</code>
<code> [117]                  :Else</code>
<code class="emphasize">→[118]                      validFlag←∆TerminateProcess hProcess CONTROL_C_EXIT</code>
<code class="emphasize">→[119]                      rc←ERROR_PROCESS_ABORTED</code>
<code> [120]                  :EndTrap</code>
<code> [121]                  (validFlag cbAvail)←PeekNamedPipeAvail hStdOutputRead 0 0 0 0 0</code>
<code> [122]                  :If validFlag</code>
<code> [123]                  :AndIf 0≠cbAvail</code>
<code> [124]                      (validFlag Buffer numberOfBytesRead)←ReadFileC hStdOutputRead cbAvail cbAvail 0 0</code>
<code> [125]                      stdOutput,←1⊃OemCToCharBuff Buffer numberOfBytesRead numberOfBytesRead</code>
<code> [126]                  :EndIf</code>
<code> [127]                  :While true STILL_ACTIVE≡2↑∆GetExitCodeThread hThread 1</code>
<code class="emphasize">→[128]                      validFlag←∆TerminateThread hThread STATUS_WAIT_0</code>
<code> [129]                  :EndWhile</code>
<code> [130]                  validFlag←CloseHandle¨hStdOutputRead hProcess hThread</code>
<code> [131]                  stdOutput←{(-0=⍴↑¯1↑⍵)↓⍵}{1↓¨(+\LF=⍵)⊂⍵}{LF,(~(CR,LF)⍷⍵)/⍵}stdOutput</code>
<code> [132]              :Else</code>
<code class="emphasize">→[133]                  rc←GetLastError</code>
<code class="emphasize">→[134]                  stdOutput←0↑⊂''</code>
<code class="emphasize">→[135]                  validFlag←CloseHandle¨hStdInputWrite hStdOutputRead hProcess hThread</code>
<code> [136]              :EndIf</code>
<code> [137]          :Else</code>
<code> [138]              rc←GetLastError</code>
<code> [139]              stdOutput←0↑⊂''</code>
<code> [140]              validFlag←CloseHandle¨hStdInputRead hStdInputWrite hStdOutputRead hStdOutputWrite</code>
<code> [141]              validFlag←FreeEnvironmentStrings pEnvironment</code>
<code> [142]          :EndIf</code>
<code> [143]      :Else</code>
<code class="emphasize">→[144]          stdOutput←0↑⊂''</code>
<code class="emphasize">→[145]          rc←GetLastError</code>
<code class="emphasize">→[146]          validFlag←CloseHandle¨hStdInputRead hStdInputWrite</code>
<code> [147]      :EndIf</code>
<code> [148]  :Else</code>
<code class="emphasize">→[149]      stdOutput←0↑⊂''</code>
<code class="emphasize">→[150]      rc←GetLastError</code>
<code> [151]  :EndIf</code>
</div>
<code class="header" id="listing_10">#.Execute.Execute.Application &mdash; 84%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {(rc processInfo result more)}←{cs}Application program</code>
<code> [1]      ⍝ # Overview</code>
<code> [2]      ⍝</code>
<code> [3]      ⍝ Run "program" in the same environment as the calling process.</code>
<code> [4]      ⍝</code>
<code> [5]      ⍝ The left argument is optional. If passed this must be a command space.</code>
<code> [6]      ⍝ You can call the public shared method `DefaultParms` in order to get</code>
<code> [7]      ⍝ a command space pre-populated with default settings. Then make</code>
<code> [8]      ⍝ appropriate changes and pass it as left argument.</code>
<code> [9]      ⍝</code>
<code> [10]     ⍝ ## Explicit Result</code>
<code> [11]     ⍝</code>
<code> [12]     ⍝ There are four items returned as explicit result:</code>
<code> [13]     ⍝ * `rc` (return code) with 0 being okay.</code>
<code> [14]     ⍝ * `processInfo`: an integer vector with process related information.</code>
<code> [15]     ⍝ * `result`: that's what is returned by `⎕OFF n` where `n` gets the result,</code>
<code> [16]     ⍝   or "Exit n" in a batch program. When wait is 0 there is no result</code>
<code> [17]     ⍝   so this is always 0 then.</code>
<code> [18]     ⍝ * `more`: might carry additional information in case something went wrong.</code>
<code> [19]  :Access Public Shared</code>
<code> [20]  ⎕IO←0 ⋄ ⎕ML←3</code>
<code> [21]  result←⍬ ⋄ more←''</code>
<code> [22]  NORMAL_PRIORITY_CLASS←32</code>
<code> [23]  'Invalid right argument'⎕SIGNAL 11/⍨(' '≠1↑0⍴∊program)∨~(≡program)∊0 1</code>
<code> [24]  cs←{0&lt;⎕NC ⍵:⍎⍵ ⋄ DefaultParms}'cs'</code>
<code> [25]  nl←cs.⎕NL-2</code>
<code> [26]  :If 0&lt;+/bool←~nl∊'dir' 'hidden' 'wait' 'timeoutAfter'</code>
<code class="emphasize">→[27]      11 ⎕SIGNAL⍨'Unknown parameters: ',↑{⍺,',',⍵}/bool/nl</code>
<code> [28]  :EndIf</code>
<code> [29]  program←EnforceBackslash program</code>
<code> [30]  :If Is64Bit</code>
<code> [31]      '∆CreateProcess'⎕NA'I4 KERNEL32.C32|CreateProcess',QnaType,'I4 &lt;0T P P I4 I4 P &lt;0T &lt;{I4 U4 P P P I4 I4 I4 I4 I4 I4 I4 I4 I2 I2 U4 P P P P} &gt;{P P I4 I4}'</code>
<code> [32]  :Else</code>
<code class="emphasize">→[33]      '∆CreateProcess'⎕NA'I4 KERNEL32.C32|CreateProcess',QnaType,' I4 &lt;0T I4 I4 I4 I4 I4 &lt;0T &lt;{I4 I4 I4 I4 I4 I4 I4 I4 I4 I4 I4 I4 I2 I2 I4 I4 I4 I4} &gt;{I4 I4 I4 I4}'</code>
<code> [34]  :EndIf</code>
<code> [35]  '∆CloseHandle'⎕NA'I4 KERNEL32.C32|CloseHandle I4'</code>
<code> [36]  'GetLastError'⎕NA'I4 KERNEL32.C32|GetLastError'</code>
<code> [37]  '∆ExpandEnvironmentStrings'⎕NA'I4 KERNEL32.C32|ExpandEnvironmentStrings',QnaType,' &lt;0T &gt;0T I4'</code>
<code> [38]  :If 0∊⍴,cs.dir</code>
<code> [39]      '∆GetCurrentDirectory'⎕NA'I4 KERNEL32.C32|GetCurrentDirectory',QnaType,' I4 &gt;T[]'</code>
<code> [40]      :If 0=↑rc←∆GetCurrentDirectory 260 260</code>
<code class="emphasize">→[41]          rc←GetLastError</code>
<code class="emphasize">→[42]          more←'GetCurrentDirectory error'</code>
<code class="emphasize">→[43]          :Return</code>
<code> [44]      :Else</code>
<code> [45]          cs.dir←↑↑/rc</code>
<code> [46]      :EndIf</code>
<code> [47]  :EndIf</code>
<code> [48]  startupInfo←CreateStartupInfo cs.hidden</code>
<code> [49]  program←ExpandEnv program</code>
<code> [50]  (rc processInfo)←∆CreateProcess null program null null true NORMAL_PRIORITY_CLASS null cs.dir startupInfo 0</code>
<code> [51]  :If false=rc</code>
<code> [52]      rc←GetLastError</code>
<code> [53]      more←'Creating process failed'</code>
<code> [54]  :Else</code>
<code> [55]      (processHandle threadHandle)←2↑processInfo</code>
<code> [56]      :If cs.wait</code>
<code> [57]          StillActive←259</code>
<code> [58]          Ctrl_C_Is←¯1073741510</code>
<code> [59]          ProcessAborted←1067</code>
<code> [60]          '∆GetExitCodeProcess'⎕NA'I4 KERNEL32.C32|GetExitCodeProcess I4 &gt;I4'</code>
<code> [61]          '∆GetExitCodeThread'⎕NA'I4 KERNEL32.C32|GetExitCodeThread I4 &gt;I4'</code>
<code> [62]          '∆WaitForSingleObject'⎕NA'I4 KERNEL32.C32|WaitForSingleObject I4 I4'</code>
<code> [63]          '∆TerminateProcess'⎕NA'I4 KERNEL32.C32|TerminateProcess I4 I4'</code>
<code> [64]          '∆TerminateThread'⎕NA'I4 KERNEL32.C32|TerminateThread I4 I4'</code>
<code> [65]          i←0</code>
<code> [66]          :Trap 1002 1003</code>
<code> [67]              :While (okay StillActive)≡2↑(∆GetExitCodeProcess GetExitCodeProcess)processHandle</code>
<code> [68]                  i←i+⎕DL 0.5</code>
<code> [69]                  :If 0≠cs.timeoutAfter</code>
<code> [70]                  :AndIf cs.timeoutAfter&lt;i</code>
<code> [71]                      result←1⊃(∆GetExitCodeProcess GetExitCodeProcess)processHandle</code>
<code> [72]                      (∆TerminateProcess TerminateProcess)(processHandle Ctrl_C_Is)</code>
<code> [73]                      more←ProcessAborted('Timeout after ',(⍕cs.timeoutAfter),' seconds')</code>
<code> [74]                      :Leave</code>
<code> [75]                  :EndIf</code>
<code> [76]              :Until null=↑(∆WaitForSingleObject WaitForSingleObject)processHandle 10</code>
<code> [77]              result←1⊃(∆GetExitCodeProcess GetExitCodeProcess)processHandle</code>
<code> [78]          :Else</code>
<code class="emphasize">→[79]              result←1⊃(∆GetExitCodeProcess GetExitCodeProcess)processHandle</code>
<code class="emphasize">→[80]              (∆TerminateProcess TerminateProcess)(processHandle Ctrl_C_Is)</code>
<code class="emphasize">→[81]              more←ProcessAborted'Process has died away'</code>
<code> [82]          :EndTrap</code>
<code> [83]          :While (true StillActive)≡(∆GetExitCodeThread GetExitCodeThread)(threadHandle)</code>
<code class="emphasize">→[84]              (∆TerminateThread TerminateThread)(threadHandle 0) ⍝ Wait Status</code>
<code> [85]          :EndWhile</code>
<code> [86]      :EndIf</code>
<code> [87]      rc←okay</code>
<code> [88]  :EndIf</code>
<code> [89]  :Trap 0</code>
<code> [90]      {}∆CloseHandle¨processHandle threadHandle</code>
<code> [91]  :EndTrap</code>
</div>
<code class="header" id="listing_11">#.Execute.Execute.WaitForSingleObject &mdash; 86%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  (status rc)←(ExFns WaitForSingleObject)parms</code>
<code> [1]   waitForTimeout←258</code>
<code> [2]   (handle milliseconds)←2↑parms,¯1 ⍝ ¯1=Infinite wait for internal timeout</code>
<code> [3]   (full last)←0(milliseconds←25)⊤milliseconds</code>
<code> [4]   (status rc)←0 ⍬</code>
<code> [5]   :Trap 1000</code>
<code> [6]       :Repeat</code>
<code> [7]           :If ¯1=full←¯1+full</code>
<code> [8]               milliseconds←last</code>
<code> [9]           :EndIf</code>
<code> [10]          status←ExFns(handle milliseconds)</code>
<code> [11]          :If waitForTimeout≠status</code>
<code> [12]              :Leave</code>
<code> [13]          :EndIf</code>
<code> [14]      :Until ¯1=full</code>
<code class="emphasize">→[15]      :OrIf 0 0≡full last</code>
<code> [16]  :Else</code>
<code class="emphasize">→[17]      rc←GetLastError</code>
<code> [18]  :EndTrap</code>
</div>
<code class="header" id="listing_12">#.Execute.Execute.History &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  History</code>
<code> [1]   :Access Public Shared</code>
<code> [2]      ⍝ * 4.0.0 ⋄ 2025-04-05</code>
<code> [3]      ⍝   * Potentially breaking change: `Version` now returns a char vector: the version from the package config file</code>
<code> [4]      ⍝ * 3.0.2 ⋄ 2020-03-02</code>
<code> [5]      ⍝   * Package config file corrected</code>
<code> [6]      ⍝ * 3.0.1 ⋄ 2020-09-21</code>
<code> [7]      ⍝   * The script delivered with 3.0.0 (and earlier versions as well) carried two &lt;TAB&gt; characters</code>
<code> [8]      ⍝     at the end of the first line, causing potentially trouble.</code>
<code> [9]      ⍝ * 3.0.0</code>
<code> [10]     ⍝   * BREAKING CHANGES:</code>
<code> [11]     ⍝     * Requires at least Dyalog 18.0</code>
<code> [12]     ⍝     * Requires the class `APLTreeUtils2`</code>
<code> [13]     ⍝   * Does not `:Include APLTreeUtils` anymore</code>
<code> [14]     ⍝\\</code>
<code> [15]     ⍝ For information regarding older versions see &lt;https://github.com/aplteam/Execute/releases&gt;</code>
</div>
<code class="header" id="listing_13">#.Execute.Execute.DefaultParms &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←DefaultParms</code>
<code> [1]   :Access Public Shared</code>
<code> [2]        ⍝ Returns a command space with all the parameters and their default settings</code>
<code> [3]        ⍝ you may specify when calling `Application`.</code>
<code> [4]        ⍝</code>
<code> [5]        ⍝ Note that the namespace provides a method `List` which you can use in</code>
<code> [6]        ⍝ order to list all names and their current values.</code>
<code> [7]        ⍝</code>
<code> [8]        ⍝ ## The parameters</code>
<code> [9]        ⍝ ### dir</code>
<code> [10]       ⍝ By default the process is running in the current directory. By</code>
<code> [11]       ⍝ specifying a different directory you can change this.</code>
<code> [12]       ⍝</code>
<code> [13]       ⍝ ### wait</code>
<code> [14]       ⍝ Defaults to 1 which means that `Application` waits until program</code>
<code> [15]       ⍝ finishes. Note the the "result" part returned by `Application` is meaningless</code>
<code> [16]       ⍝ if "wait" is 0: naturally you cannot expect a result in such a case.</code>
<code> [17]       ⍝</code>
<code> [18]       ⍝ ### hidden</code>
<code> [19]       ⍝ Defaults to 0. That means that command.com will show a console window --</code>
<code> [20]       ⍝ just an example. If Dyalog is fired up and the app writes to the</code>
<code> [21]       ⍝ session you will see the session window.</code>
<code> [22]       ⍝</code>
<code> [23]       ⍝ However, if you set this to 1, the session window won't turn up</code>
<code> [24]       ⍝ no matter whether the app does write to it or not.</code>
<code> [25]       ⍝</code>
<code> [26]       ⍝ Note the danger: if APL crashs and no error trapping is used, then</code>
<code> [27]       ⍝ the session manager should pop up. If that is suppressed but setting</code>
<code> [28]       ⍝ "hidden" to 1 then the user has no means to quit that APL task. The only</code>
<code> [29]       ⍝ way to get rid of it is to cancel the process in the task manager.</code>
<code> [30]  r←⎕NS''</code>
<code> [31]  r.dir←''              ⍝ Default: Current Dir</code>
<code> [32]  r.hidden←0            ⍝ Allow Window to pop up</code>
<code> [33]  r.wait←1              ⍝ Wait for app to return</code>
<code> [34]  r.timeoutAfter←0      ⍝ Specify the number of seconds; 0=no timeout</code>
<code> [35]  r.⎕FX'r←List' '{⍵,[⎕io+.1]⍎¨⍵}⎕nl -2'</code>
</div>
<code class="header" id="listing_14">#.Execute.Execute.ExpandEnv &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ExpandEnv string</code>
<code> [1]     ⍝  'C:\Windows\MyDir' ←→ ExpandDir '%WinDir%\MyDir'</code>
<code> [2]  :If '%'∊r←string</code>
<code> [3]      r←1⊃∆ExpandEnvironmentStrings(string 1024 1024)</code>
<code> [4]  :EndIf</code>
</div>
<code class="header" id="listing_15">#.Execute.Execute.QnaType &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←QnaType</code>
<code> [1]  ⎕IO←0</code>
<code> [2]  r←(12&gt;{⍎⍵↑⍨¯1+⍵⍳'.'}1⊃'.'⎕WG'APLVersion')⊃'A*'</code>
</div>
<code class="header" id="listing_16">#.Execute.Execute.Is64Bit &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Is64Bit</code>
<code> [1]  r←'-64'≡¯3↑⎕IO⊃'#'⎕WG'APLVersion'</code>
</div>
<code class="header" id="listing_17">#.Execute.Execute.cs &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block missing">Could not get canonical representation.</div>
<div id="footer">
<hr>
<p>Created by "CodeCoverage" version 0.10.7+52 from 2024-06-05</p>
</div>

</body>
</html>
